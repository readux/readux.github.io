<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Extending - Readux Documentation</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">


    <link href="../extra/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Readux Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../design/">Design</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Extending</a>
                    </li>
                
                
                
                    <li >
                        <a href="../tutorial/">Tutorial</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../design/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../tutorial/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/readux/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#extending-readux">Extending Readux</a></li>
        
            <li class="second-level"><a href="#middleware">Middleware</a></li>
            
                <li class="third-level"><a href="#example-handling-promises">Example: Handling Promises</a></li>
            
                <li class="third-level"><a href="#example-verifying-app-model-with-cljsspec">Example: Verifying app model with cljs.spec</a></li>
            
                <li class="third-level"><a href="#writing-middleware">Writing middleware</a></li>
            
                <li class="third-level"><a href="#using-middleware">Using middleware</a></li>
            
        
            <li class="second-level"><a href="#store-enhancers">Store enhancers</a></li>
            
                <li class="third-level"><a href="#example-readux-debugger">Example: readux-debugger</a></li>
            
                <li class="third-level"><a href="#writing-store-enhancers">Writing Store Enhancers</a></li>
            
                <li class="third-level"><a href="#using-store-enhancers">Using Store Enhancers</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="extending-readux">Extending Readux</h1>
<p>This document assumes familiarity with what's written intended
<a href="../design/">the design</a>, which explains the rationale and introduces core
terminology.</p>
<p>In general, Readux is intended to be extended through middleware and store
enhancers, both of which are described below.</p>
<h2 id="middleware">Middleware</h2>
<p>Middleware is used whenever you wish to automatically do something
before an action reaches your store's root reducer or before the
resulting model is persisted.</p>
<h3 id="example-handling-promises">Example: Handling Promises</h3>
<p>Say we wanted to automatically process incoming actions which submits a
promise as their argument, splitting the action <code>:FOO</code> into <code>:FOO/PENDING</code>
<code>:FOO/SUCCESS</code> and <code>:FOO/FAILURE</code> to signify when the request is made,
and when it ends in a success or an error, respectively.
We could wrap this process ourselves for each async request our application
would make, or write a piece of middleware to handle promises for us.</p>
<h3 id="example-verifying-app-model-with-cljsspec">Example: Verifying app model with cljs.spec</h3>
<p>Similarly, if you wished to ensure that for each action, the model
retained some specific structure, you could implement a middleware function
to validate the resulting model against a clojure.spec schema.</p>
<h3 id="writing-middleware">Writing middleware</h3>
<p><strong>Signature:</strong> <code>next -&gt; model, action [, args ...] -&gt; new-model</code></p>
<p>We see from the signature that middleware takes a single argument '<code>next</code>', which
is the middleware/reducer function to execute next. From this, we get a function,
which, when given a '<code>model</code>', an '<code>action</code>' (and optionally some '<code>args</code>'),
yields a new model which is the result of applying the action to the old model.</p>
<pre><code class="clojure">;; This middleware does nothing but pass the action along.
(defn passthrough-middleware
  [next]
  (fn [model action &amp; args]
    (apply next model action args)))
</code></pre>

<h3 id="using-middleware">Using middleware</h3>
<p>Middleware is used by composing it with your application's reducer using <a href="http://clojuredocs.org/clojure.core/comp">composition (<code>comp</code>)</a>
or the <a href="http://clojuredocs.org/clojure.core/-%3E">threading macro (<code>-&gt;</code>)</a> threading macro.</p>
<p>You can express the order of execution in whichever way feels the most natural:</p>
<pre><code class="clojure">((-&gt; my-reducer baz bar foo) ...)
;;execution order: foo, bar, baz, my-reducer

(((comp baz bar foo) my-reducer) ...)
;; execution order: baz, bar, foo, my-reducer
</code></pre>

<h2 id="store-enhancers">Store enhancers</h2>
<p><strong>Signature:</strong> <code>store -&gt; store</code></p>
<p>Store enhancers, as their name implies, modify the store object itself. Generally, store enhancers should be used when
middleware won't suffice, such as when new functionality relying on additional fields in the store object is implemented.</p>
<h3 id="example-readux-debugger">Example: readux-debugger</h3>
<p>For example, the readux-debugger creates an additional store, tied to the app-store which controls its own model and which
has its own reducer. By enhancing the store, it can replace the standard dispatch-function invoked when an action is 
dispatched.
The dispatch function normally finds the store's reducer, and passes along the action, storing the value returned as the
new model.
By replacing the dispatcher, the readux-debugger can intercept and assure that debug-related actions never reach the
app reducer while ensuring app-related actions are dispatched to both the debugger and app stores.</p>
<h3 id="writing-store-enhancers">Writing Store Enhancers</h3>
<p>The smallest possible example is also a bit silly, typically you want to wrap the <code>:dispatch</code> function or add some
additional entries to facilitate some expanded interface.</p>
<pre><code class="clojure">(defn make-stores-great-again
  [app-store]
  (swap! app-store assoc :is-great? true))
</code></pre>

<p>With our additional data, we can implement new store functions, such as this:</p>
<pre><code>(defn great-store?
  [store] 
  (get @store :is-great? false))
</code></pre>

<h3 id="using-store-enhancers">Using Store Enhancers</h3>
<p>The store function accepts an additional argument, allowing you to specify an enhancer function.
To use multiple store enhancers, use <a href="http://clojuredocs.org/clojure.core/comp">composition</a>.</p>
<pre><code>(def s (store my-reducer make-stores-great-again))
(great-store? s)
;;=&gt; true
</code></pre></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
